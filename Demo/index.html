<!DOCTYPE html>
<html lang="en">

<head>
  <title>TIMS</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap.min.css">
  
  <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
  <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.11.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.11.0/firebase-firestore.js"></script>

  <script>
    var firebaseConfig = {
      apiKey: "AIzaSyDQCfr1bfMkJc_-on2eCbzh3i2ZplSkjfM",
      authDomain: "wharton-volunteers.firebaseapp.com",
      databaseURL: "https://wharton-volunteers.firebaseio.com",
      projectId: "wharton-volunteers",
      storageBucket: "wharton-volunteers.appspot.com",
      messagingSenderId: "1067661612787",
      appId: "1:1067661612787:web:b6eac7c8fb4aff84260986"
    };
    firebase.initializeApp(firebaseConfig);
  </script>

</head>

<body style="background-color:AliceBlue;">


  <div class="row" style="background-color:Navy;">
    <div class="col">
      <h1 align="center" style="color:white;">Transformational Impact Measurement System</h1>
      <p align="center" style="color:white;"> <i>An Online Platform to Connect Hospitals with Volunteers and Donors</i></p>
    </div>
  </div>

  <div style="background-color:WhiteSmoke;">
    <ul class="nav nav-tabs nav-justified">
      <li class="nav-item" style="border:1px solid black;">
        <a class="nav-link active" href="index.html">Home</a>
      </li>
      <li class="nav-item" style="border:1px solid black;">
        <a class="nav-link" href="calculator.html">Calculator</a>
      </li>
      <li class="nav-item" style="border:1px solid black;">
        <a class="nav-link" href="about.html">About Us</a>
      </li>
      <li class="nav-item" style="border:1px solid black;">
        <a class="nav-link" href="auth.html?websiteId=create.html">Add New Hospital</a>
      </li>
    </ul>
  </div>

  <section>
    <div class="container-fluid p-0" >
      
      <div id="bioSec" style="width:100%; height:45vw; min-height: 350px; background-color: #d0f5fc;">
        <div class="container" style="padding-top: 20px;">
        <div class="jumbotron bg-primary" style="padding-top: 25px;">
            <h4 class="display-4 text-center text-white" style="font-size:  5vw; padding-bottom: 20px; margin-top: 0; top: 0;">
            Find High-Impact Hospitals
                  
            </h4>
            <p class="lead text-white" style="font-size:  1.4vw;">
              Our ratings system evaluates hospitals – primarily in areas with few resources and high community need – to identify where donations and volunteer time could have the greatest marginal impact. Our mission is to improve the health of as many people as possible by assisting donors and volunteers in finding these high-impact hospitals around the world.
            </p>
            <hr class="my-4">
            <p class="lead text-white" style="font-size:  1.4vw;">
              We rate hospitals based on six key categories: regional impact potential, financial health, operational efficiency, external relations, volunteer opportunity, and volunteer satisfaction. Each category is measured based on several weighted variables, which are combined into an overall impact score. Data is collected from publicly available sources, input from hospital staff, and surveys of previous donors and volunteers. Our methodology is fully explained <a href="about.html">here</a>.
            </p>
          </div>
        </div>
        
      </div>
      
    </div>
  </section>

  <section>
    <div class="container-fluid p-0"> 

      <!---- Google Map ------>
      <!--AIzaSyA_QNYsXvsj5Da5GCh5TYaH48o_TLlZzJE-->


      <div id="map" style="width:100%; height:400px;"></div>
      

     <!--  <script>
      
    </script> -->
    
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <div id="map"></div>
    <script>
      var map;
      var pos;
      var url = "https://maps.googleapis.com/maps/api/geocode/json";
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: -34.397, lng: 150.644},
          zoom: 8
        });
      }

      function addMarker(addy) {
        
         axios.get(url, {
          params:{
            address: addy,
            key: 'AIzaSyA_QNYsXvsj5Da5GCh5TYaH48o_TLlZzJE'
          } 
         }).then(function(response){
          console.log(response);

          pos = response.data.results[0].geometry.location;
          console.log(pos);
          var marker = new google.maps.Marker({position: pos, map: map});
         }).catch(function(error){
          console.log(error);
         });
         

      }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA_QNYsXvsj5Da5GCh5TYaH48o_TLlZzJE&callback=initMap"
    async defer></script>

      

  
      
    </div>
  </section>

  <section>
    <div class="container-fluid p-0" style="background-color: #d0f5fc;">
      <div class="container" style="background-color: #fff; padding-top: 20px;">
          <div class="row">
            <div class="col-2">
              <p> Table Search </p>
            </div>
            <div class="col-lg-6">
              <input id="search-input" class="form-control" type="text">
            </div>
          </div>
          <br>
          <table id="myData" class="table table-striped table-bordered table-hover" style="width:100%">
            <thead class="thead-dark">
                <tr>
                    <th data-colname="Hospital Name">Hospital Name</th>
                    <th data-colname="Hospital Address">Location</th>
                    <th data-colname="Hospital Contact">Contact</th>
                    <th data-colname="R rating" data-order="desc">Impact Rating</th>
                    <th>See More</th>
                </tr>
            </thead>
            <tbody id="myTable">

            </tbody>
          </table>
        </div>
    </div>
  </section>


  <script>

    var data = [];
    
    function myFunc(elt) {
      
      var db = firebase.firestore();
      var count = 0;
      db.collection("hospitals")
        .get()
        .then(function(querySnapshot) {
          querySnapshot.forEach(function(doc) {
            console.log(doc.id, " => ", doc.data()); 
            // Add to data collection
            console.log(doc.data())
            var elt = { "name" : doc.data()["Hospital Name"], "address" : doc.data()["Hospital Address"], "contact" : doc.data()["Hospital Contact"], "rating" : doc.data()["R rating"]}
            data[count] = elt;
            console.log(data[count]);
            count++
            // Add marker to map
            var addy = doc.data()["Hospital Address"];
            addMarker(addy);

            //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
          });
          elt(data);
        })
        .catch(function(error) {
          console.log("Error getting documents: ", error);
        });
        
        
      }

      myFunc(buildTable)
      

      function buildTable(d){
        console.log("Here");
        console.log(JSON.stringify(d));
        

        var tableBody = document.getElementById("myTable");
        tableBody.innerHTML = ''

        for (var i = 0; i < d.length; i++) {

          var tr = document.createElement('TR');
          tableBody.appendChild(tr);

          var td = document.createElement('TD');
          td.appendChild(document.createTextNode(d[i].name));
          tr.appendChild(td);

          var td = document.createElement('TD');
          td.appendChild(document.createTextNode(d[i].address));
          tr.appendChild(td);

          var td = document.createElement('TD');
          td.appendChild(document.createTextNode(d[i].contact));
          tr.appendChild(td);

          var td = document.createElement('TD');
          td.appendChild(document.createTextNode(Number(d[i].rating).toFixed(2) + " / 5"));
          tr.appendChild(td);

          var b = document.createElement('Button');
          b.innerHTML = "See More";
          b.setAttribute("id", "btn btn-primary");
          b.onclick = function() {
            location.href = ("hospital.html?username=" + id);
          };

          var td = document.createElement('TD');
          td.appendChild(b);
          tr.appendChild(td);

        }
      
      
      }
      $('#search-input').on('keyup', function(){
        var value = $(this).val()
        console.log('Value: ', value)
        var info = searchTable(value, data)
        buildTable(info)
      })

      function searchTable(value, da) {
        var filteredData = []
        for (var i = 0; i < da.length; i++) {
          value = value.toLowerCase()
          var info = da[i].name.toLowerCase() + da[i].address.toLowerCase() + da[i].contact.toLowerCase()
          console.log('Value', value, ' info: ', info)
          if (info.includes(value)) {
            filteredData.push(da[i])
          }
        }
        return filteredData
      }

    
  </script>
</body>

</html>