<!DOCTYPE html>
<html lang="en">

<head>
  <title>TIMS</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <script src="https://www.gstatic.com/firebasejs/7.11.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.11.0/firebase-firestore.js"></script>
  <script>
    var firebaseConfig = {
      apiKey: "AIzaSyDQCfr1bfMkJc_-on2eCbzh3i2ZplSkjfM",
      authDomain: "wharton-volunteers.firebaseapp.com",
      databaseURL: "https://wharton-volunteers.firebaseio.com",
      projectId: "wharton-volunteers",
      storageBucket: "wharton-volunteers.appspot.com",
      messagingSenderId: "1067661612787",
      appId: "1:1067661612787:web:b6eac7c8fb4aff84260986"
    };
    firebase.initializeApp(firebaseConfig);
  </script>

</head>

<body style="background-color:AliceBlue;">


  <div class="row" style="background-color:Navy;">
    <div class="col">
      <h1 align="center" style="color:white;">Transformational Impact Measurement System</h1>
      <p align="center" style="color:white;"> <i>An Online Platform to Connect Hospitals with Volunteers and Donors</i></p>
    </div>
  </div>

  <div style="background-color:WhiteSmoke;">
    <ul class="nav nav-tabs nav-justified">
      <li class="nav-item" style="border:1px solid black;">
        <a class="nav-link active" href="index.html">Home</a>
      </li>
      <li class="nav-item" style="border:1px solid black;">
        <a class="nav-link" href="about.html">About Us</a>
      </li>
      <li class="nav-item" style="border:1px solid black;">
        <a class="nav-link" href="auth.html">Add New Hospital</a>
      </li>
    </ul>
  </div>
  <br>

  <section>
    <div class="container-fluid">
      <p style="font-size:  1.2vw;">
        Our ratings system evaluates hospitals – primarily in areas with few resources and high community need – to identify where donations and volunteer time could have the greatest marginal impact. Our mission is to improve the health of as
        many people as possible by assisting donors and volunteers in finding these high-impact hospitals around the world.
      </p>
      <p style="font-size:  2vw;">
        How it works
      </p>
      <p style="font-size:  1.2vw;">
        We rate hospitals based on six key categories: regional impact potential, financial health, operational efficiency, external relations, volunteer opportunity, and volunteer satisfaction. Each category is measured based on several
        weighted variables, which are combined into an overall impact score. Data is collected from publicly available sources, input from hospital staff, and surveys of previous donors and volunteers. Our methodology is fully explained <a
          href="about.html">here</a>.
      </p>
      <p style="font-size:  2vw;">
        Find high impact hospitals
      </p>

    </div>
  </section>

  <section>
    <div class="container-fluid">
      <div id="map" style="width:100%; height:400px;">
      </div>

      <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
      <div id="map"></div>
      <script>
        var map;
        var pos;
        var url = "https://maps.googleapis.com/maps/api/geocode/json";

        function initMap() {
          map = new google.maps.Map(document.getElementById('map'), {
            center: {
              lat: 20.5937,
              lng: 78.9629
            },
            zoom: 4
          });
        }

        function addMarker(addy) {
          axios.get(url, {
            params: {
              address: addy,
              key: 'AIzaSyA_QNYsXvsj5Da5GCh5TYaH48o_TLlZzJE'
            }
          }).then(function(response) {
            console.log(response);

            pos = response.data.results[0].geometry.location;
            console.log(pos);
            var marker = new google.maps.Marker({
              position: pos,
              map: map
            });
          }).catch(function(error) {
            console.log(error);
          });


        }
      </script>
      <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA_QNYsXvsj5Da5GCh5TYaH48o_TLlZzJE&callback=initMap" async defer></script>

    </div>
  </section>

  <section>
    <div class="container-fluid">
      <div class="table-responsive-lg" style="background-color: #e1ecf0;">
        <table class="table table-striped table-bordered table-hover" id="myData">
          <thead class="thead-dark">
            <tr>
              <th scope="col">Hospital Name</th>
              <th scope="col">Location</th>
              <th scope="col">Contact</th>
              <th scope="col">Overall Impact Rating</th>
              <th scope="col">See More</th>
            </tr>
          </thead>
          <tbody id="tBody">
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <script>
    function addRow(name, addy, contact, rating, id) {

      var tableBody = document.getElementById("tBody");

      var tr = document.createElement('TR');
      tableBody.appendChild(tr);

      var td = document.createElement('TD');
      td.appendChild(document.createTextNode(name));
      tr.appendChild(td);

      var td = document.createElement('TD');
      td.appendChild(document.createTextNode(addy));
      tr.appendChild(td);

      var td = document.createElement('TD');
      td.appendChild(document.createTextNode(contact));
      tr.appendChild(td);

      var td = document.createElement('TD');
      td.appendChild(document.createTextNode(Number(rating).toFixed(2)));
      tr.appendChild(td);

      var b = document.createElement('Button');
      b.innerHTML = "See More";
      b.setAttribute("id", "btn btn-primary");
      b.onclick = function() {
        location.href = ("hospital.html?username=" + id);
      };

      var td = document.createElement('TD');
      td.appendChild(b);
      tr.appendChild(td);

    }
  </script>
  <script>
    onclick = "location.href=…"

    var db = firebase.firestore();

    db.collection("hospitals")
      .get()
      .then(function(querySnapshot) {
        querySnapshot.forEach(function(doc) {
          console.log(doc.id, " => ", doc.data()); // add this info to table and Google maps
          // Populate Table ~~~~~~~~~~~~~~~~~~
          var name = doc.data()["Hospital Name"];
          var addy = doc.data()["Hospital Address"];
          var contact = doc.data()["Hospital Contact"];
          var rating = doc.data()["R rating"];
          addRow(name, addy, contact, rating, doc.id);
          addMarker(addy);
          //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
        });
      })
      .catch(function(error) {
        console.log("Error getting documents: ", error);
      });
  </script>
</body>

</html>