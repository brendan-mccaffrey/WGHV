<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
  <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.11.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.11.0/firebase-firestore.js"></script>

  <script>
    var firebaseConfig = {
      apiKey: "AIzaSyDQCfr1bfMkJc_-on2eCbzh3i2ZplSkjfM",
      authDomain: "wharton-volunteers.firebaseapp.com",
      databaseURL: "https://wharton-volunteers.firebaseio.com",
      projectId: "wharton-volunteers",
      storageBucket: "wharton-volunteers.appspot.com",
      messagingSenderId: "1067661612787",
      appId: "1:1067661612787:web:b6eac7c8fb4aff84260986"
    };
    firebase.initializeApp(firebaseConfig);
  </script>
</head>
<body>
  <section>
    <div class="container-fluid p-0" style="background-color: #d0f5fc;">
      <div class="container" style="background-color: #fff; padding-top: 20px;">
          
          <table id="dtBasicExample" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
            <thead class="thead-dark">
                <tr>
                    <th data-colname="Hospital Name">Hospital Name</th>
                    <th data-colname="Hospital Address">Location</th>
                    <th data-colname="Hospital Contact">Contact</th>
                    <th data-colname="R rating" data-order="desc">Impact Rating</th>
                    <th>See More</th>
                </tr>
            </thead>
            <tbody id="myTable">

            </tbody>
          </table>
        </div>
    </div>
  </section>

  <script>
    function myFunc(elt) {
      var data = [];
      var db = firebase.firestore();
      var count = 0;
      db.collection("hospitals")
        .get()
        .then(function(querySnapshot) {
          querySnapshot.forEach(function(doc) {
            console.log(doc.id, " => ", doc.data()); 
            // Add to data collection
            console.log(doc.data())
            var elt = { "name" : doc.data()["Hospital Name"], "address" : doc.data()["Hospital Address"], "contact" : doc.data()["Hospital Contact"], "rating" : doc.data()["R rating"]}
            data[count] = elt;
            console.log(data[count]);
            count++
            // Add marker to map
            var addy = doc.data()["Hospital Address"];
            //addMarker(addy);

            //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
          });
          elt(data);
        })
        .catch(function(error) {
          console.log("Error getting documents: ", error);
        });
    }

    myFunc(buildTable)
    
    $(document).ready(function () {
    $('#dtBasicExample').DataTable();
    $('.dataTables_length').addClass('bs-select');
    });
      

      function buildTable(d){
        console.log("Here");
        console.log(JSON.stringify(d));
        var tableBody = document.getElementById("myTable");

        for (var i = 0; i < d.length; i++) {

          var tr = document.createElement('TR');
          tableBody.appendChild(tr);

          var td = document.createElement('TD');
          td.appendChild(document.createTextNode(d[i].name));
          tr.appendChild(td);

          var td = document.createElement('TD');
          td.appendChild(document.createTextNode(d[i].address));
          tr.appendChild(td);

          var td = document.createElement('TD');
          td.appendChild(document.createTextNode(d[i].contact));
          tr.appendChild(td);

          var td = document.createElement('TD');
          td.appendChild(document.createTextNode(Number(d[i].rating).toFixed(2) + " / 5"));
          tr.appendChild(td);

          var b = document.createElement('Button');
          b.innerHTML = "See More";
          b.setAttribute("id", "btn btn-primary");
          b.onclick = function() {
            location.href = ("hospital.html?username=" + id);
          };

          var td = document.createElement('TD');
          td.appendChild(b);
          tr.appendChild(td);

        }
      
      
      }

    
  </script>

  


</body>
</html>